{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>Suggestion for Today</h2>
    <div id="suggestion-result" class="mt-4 text-center">
        <div class="spinner-border" role="status" id="loading-spinner">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <button class="btn btn-secondary mt-4" onclick="window.location.href='/'">Back to Main</button>
</div>
<script>
function fetchSuggestion() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            fetch('/suggestion', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ lat, lon })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading-spinner').style.display = 'none';
                if (data.image && data.text) {
                    document.getElementById('suggestion-result').innerHTML =
                        `<img src="${data.image}" class="img-fluid rounded mb-3" style="max-height:300px;" alt="Suggestion"><br>` +
                        `<p class="lead">${data.text}</p>`;
                } else {
                    document.getElementById('suggestion-result').innerHTML = '<p>No suggestion available.</p>';
                }
            })
            .catch(() => {
                document.getElementById('loading-spinner').style.display = 'none';
                document.getElementById('suggestion-result').innerHTML = '<p>Error retrieving suggestion.</p>';
            });
        }, function() {
            document.getElementById('loading-spinner').style.display = 'none';
            document.getElementById('suggestion-result').innerHTML = '<p>Geolocation permission denied.</p>';
        });
    } else {
        document.getElementById('loading-spinner').style.display = 'none';
        document.getElementById('suggestion-result').innerHTML = '<p>Geolocation is not supported by this browser.</p>';
    }
}
window.onload = fetchSuggestion;
</script>
{% endblock %}
